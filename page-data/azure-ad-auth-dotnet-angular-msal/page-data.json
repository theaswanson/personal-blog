{"componentChunkName":"component---src-templates-blog-post-js","path":"/azure-ad-auth-dotnet-angular-msal/","result":{"data":{"site":{"siteMetadata":{"title":"Adam Swanson's Blog"}},"markdownRemark":{"id":"5d37dc7f-d842-55d5-a494-2e67a5cc9242","excerpt":"I recently went through this process and was disappointed at the lack of documentation. Then I realized that the latest version of the  library I used was onlyâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/acf64d05c65d853331b47475c731996d/0f98f/header.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB5s47QwhL/8QAGhAAAQUBAAAAAAAAAAAAAAAAAAECAxESEP/aAAgBAQABBQJI2rDkfWi+f//EABYRAQEBAAAAAAAAAAAAAAAAAAABIf/aAAgBAwEBPwGYr//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPwGhf//EABsQAAIBBQAAAAAAAAAAAAAAAAABIQISICIx/9oACAEBAAY/AnXdIm4TNeYf/8QAGhABAAMAAwAAAAAAAAAAAAAAAQAQETFBcf/aAAgBAQABPyFyELxHPtUBY96tKTFr/9oADAMBAAIAAwAAABAz3//EABYRAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAwEBPxAqq3Kt3//EABcRAQADAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QwpI//8QAHBABAAAHAQAAAAAAAAAAAAAAAQAQESExUWFB/9oACAEBAAE/ELRmFeOPXyFJRAUa3C6SbhdkMQhgZf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Header\"\n        title=\"\"\n        src=\"/static/acf64d05c65d853331b47475c731996d/828fb/header.jpg\"\n        srcset=\"/static/acf64d05c65d853331b47475c731996d/ff44c/header.jpg 158w,\n/static/acf64d05c65d853331b47475c731996d/a6688/header.jpg 315w,\n/static/acf64d05c65d853331b47475c731996d/828fb/header.jpg 630w,\n/static/acf64d05c65d853331b47475c731996d/0ede0/header.jpg 945w,\n/static/acf64d05c65d853331b47475c731996d/3ac88/header.jpg 1260w,\n/static/acf64d05c65d853331b47475c731996d/0f98f/header.jpg 1920w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I recently went through this process and was disappointed at the lack of documentation. Then I realized that the latest version of the <code class=\"language-text\">msal-angular</code> library I used was only 8 days old at the time of writing, so that explains some things.</p>\n<p>In either case, I've decided to write out my steps for anyone else looking to setup a similar project with this type of authentication. To walk through this process, we'll be creating a web app from scratch and deploying it to a new App Service in Azure. We'll also register the app in Azure AD.</p>\n<p>You can find the completed web app <a href=\"https://github.com/theaswanson/my-authenticated-app\">here</a>, or you can follow along and create it yourself using the steps below.</p>\n<p>To summarize, here's what we're building:</p>\n<ul>\n<li>Web app with .NET 5 Web API and Angular 11, hosted in an Azure App Service</li>\n<li>Authentication with Azure AD using the <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow\">Microsoft Identity platform and OAuth 2.0 authorization code flow</a>, and the <a href=\"https://www.npmjs.com/package/@azure/msal-angular\">@azure/msal-angular@2.0.0-beta.0</a> package</li>\n</ul>\n<p>And here's what we're gonna do:</p>\n<ol>\n<li>Create a new project from the .NET Angular template</li>\n<li>Upgrade the Angular app from 8 to 11</li>\n<li>Deploy the app to an App Service</li>\n<li>Add a new app registration in Azure AD</li>\n<li>Configure the app redirect URIs to ensure eligibility for the Authorization Code Flow with PKCE.</li>\n<li>Configure the .NET Web API for authentication, authorization, and CORS</li>\n<li>Install MSAL and other dependencies for Angular</li>\n<li>Configure MSAL and Angular app for authentication</li>\n<li>Redeploy to App Service</li>\n</ol>\n<p>Requirements:</p>\n<ul>\n<li>Microsoft Azure account with free-tier subscription (for Azure AD and App Service)</li>\n<li>Visual Studio Code (for running and editing the app)</li>\n<li>VSCode Azure App Service extension (for publishing to the App Service)</li>\n<li>.NET 5.0 (for running the app and adding packages)</li>\n<li>Node and npm (for updating Angular, installing MSAL, and Angular CLI)</li>\n<li>Angular CLI (for generating the <code class=\"language-text\">AuthService</code>)</li>\n</ul>\n<h2>Create the web app</h2>\n<ol>\n<li>\n<p>Generate the app using the .NET Angular template</p>\n<ul>\n<li><code class=\"language-text\">dotnet new angular -o my-authenticated-app</code></li>\n</ul>\n</li>\n<li>\n<p>Trust the certificate, if needed</p>\n<ul>\n<li><code class=\"language-text\">dotnet dev-certs https --trust</code></li>\n</ul>\n</li>\n<li>\n<p>Upgrade Angular from 8 to 11</p>\n<ul>\n<li>From the <code class=\"language-text\">ClientApp</code> folder, run these commands:</li>\n<li><code class=\"language-text\">ng update @angular/core@8 @angular/cli@8</code></li>\n<li><code class=\"language-text\">ng update @angular/core@9 @angular/cli@9</code></li>\n<li>Remove <code class=\"language-text\">export { renderModule, renderModuleFactory } from '@angularplatform-server'</code> from <code class=\"language-text\">main.ts</code></li>\n<li>Change <code class=\"language-text\">progress: false</code> to <code class=\"language-text\">progress: true</code> in <code class=\"language-text\">angular.json</code></li>\n<li><code class=\"language-text\">npm uninstall @nguniversal/module-map-ngfactory-loader</code></li>\n<li>Remove <code class=\"language-text\">ModuleMapLoaderModule</code> import and reference from <code class=\"language-text\">app.server.module.ts</code></li>\n<li><code class=\"language-text\">ng add @angular/localize</code></li>\n<li><code class=\"language-text\">ng update @angular/cli@10 @angular/core@10 rxjs</code></li>\n<li><code class=\"language-text\">ng update @angular/cli@11 @angular/core@11 --force</code></li>\n<li><code class=\"language-text\">npm uninstall node-sass</code></li>\n<li><code class=\"language-text\">npm i -g npm-check-updates</code></li>\n<li><code class=\"language-text\">ncu -u</code></li>\n<li><code class=\"language-text\">npm i</code></li>\n<li><code class=\"language-text\">npm update</code></li>\n<li><code class=\"language-text\">npm audit fix</code></li>\n<li><code class=\"language-text\">npm i -D typescript@4.1.5</code></li>\n</ul>\n</li>\n<li>\n<p>Run the app and verify it starts correctly. You should get a page like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e37035eaf30b0c583311a5301f327738/6be49/hello-world.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42o2SWU/DMBCE8/9/XXkBNU1Km4s0p+MjbnN9yIYKcQgYabQv9uzszgbWXhmGASEGtNZ8xbZtP9JhnmeMGTHjiFKa6+1GcDqd2e12HKKI3cMDRmvmZWGaJtZ1/VX0LnyvDoFUirysudQdRVnRNC1t09J1PcaYT4//g2CeF/bVwnMpORY95zSjvJR+BdZa7/TbGn4THK2lbjqqqqZpGu/QOXPjLsvywffx/3ToHIRhyNN+z+PjE0macU4SkjQlTTOyLCfPC3TdI8VAL4QPcVASMQi0NkipcMa8oOscRhFJfCIOIw5xjAsqio/E8ZFDFPv6fDyRZzlV3TBKzaYtNzX61QxS+uqmCq7GYqoe8dJQlhdeypIiL6jrmrbt3ti90TlxITqHSiq00mjpqBC9YJ1mgvU6YfXoKbVCSuk/uFW4hF3X+4m4adYv3N7pT2zbeAVJB7aFe/JiEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hello World\"\n        title=\"\"\n        src=\"/static/e37035eaf30b0c583311a5301f327738/f058b/hello-world.png\"\n        srcset=\"/static/e37035eaf30b0c583311a5301f327738/c26ae/hello-world.png 158w,\n/static/e37035eaf30b0c583311a5301f327738/6bdcf/hello-world.png 315w,\n/static/e37035eaf30b0c583311a5301f327738/f058b/hello-world.png 630w,\n/static/e37035eaf30b0c583311a5301f327738/40601/hello-world.png 945w,\n/static/e37035eaf30b0c583311a5301f327738/6be49/hello-world.png 1160w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>View the \"Fetch data\" page. It should load the weather data. Later, after we add authentication, this page will require authentication and will not load the weather data unless a user is logged in.</li>\n</ul>\n</li>\n</ol>\n<h2>Create the App Service</h2>\n<ol>\n<li>\n<p>In the Azure portal, under App Services, click \"Create\"</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ec2e50307fe3294fb410682e8a78a9d/6f3f2/create-app-service.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVR42m2Su28aQRjE6ZB5wz0Nd3CQgxMGgQCJuxMBQeMECzlCyLgHl7RQ0FAh/uxf9G2ErUQpdvfb18zszCZyuRy+79NsNrFtW7V2u63WKpUKnudRr9cpl8s4joOu6+TzeUzTxDAMCoUCxWLxsyWSyST7/Z7r9crtdmO327FarVR9Op04n88cDgeOxyOXy0URZTIZxuOxItQ0DcuyvgClExWTyYTlckkcxzQaDXq9nrosezJvtVpqflclSv9VpwDlyUEQMBqN6Pf7qh4MBnS7XYbDIa7rkk6nyWazStn/QP4ClO7Rtqm6jvJIPBR/xDND1ykWchQLeR4eUmTSaQUuwKlU6pPgi6REQgx+euoQz1+Yzub8en1lvV7zslxS8xrYwRTHaxJHIZ1OVymXAO+WWLaNoWvoj3VMN/gDKKlGs2e+T2e8b7fsPz7Yvr1RrXlYfohT8/n545n5fMFmsyGKIhaLBWEYUqk4WJaJZjqYTouEyBWf/G8N9T2q1apK7z4ahoZh6IjXQi7nS6WSquWZEpJYJKCS9m+RAuRpVgIphgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create an App Service\"\n        title=\"\"\n        src=\"/static/1ec2e50307fe3294fb410682e8a78a9d/6f3f2/create-app-service.png\"\n        srcset=\"/static/1ec2e50307fe3294fb410682e8a78a9d/c26ae/create-app-service.png 158w,\n/static/1ec2e50307fe3294fb410682e8a78a9d/6f3f2/create-app-service.png 256w\"\n        sizes=\"(max-width: 256px) 100vw, 256px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Select your Azure subscription and resource group. Set a name under Instance Details, set Publish to \"Code\", Runtime stack to \".NET 5\", Operating System to \"Windows\", and select a region. Also select an appropriate Windows Plan. Click \"Review + create\".</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a0c96b51d5e9046dc79f440f3dd3690/3c051/create-web-app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAADM0lEQVR42o2UyZLbNhCGdU9Z3LAQXEBwl6iFkmcySVUUzeJjjskj5DHyAKm89O/qlkhLE8fO4SuQINH994bFZhjwfD7jdDrhdPoF5/MZSil4ngff95kwDP8XQRBgkdkC1pXI8xzOOWRZhjiOkSQJrzqOsVwuvws5ZoOuarHZjRiGNbbbLcqyRN/3WK8v78N6jaIoeJ8gp9PzLeScjC5WqxU+fXrjkN/eXvH6+oqXlxfm+fkZH3864/HnX/Hw8MAcj0fmcDhgHEdeHx8f0XUdp2lB1g/HI6uRUkIIwSglEUUR/FAiiAR83+PQ6NAt/wq5qir28PT0xKGSA1Ldti2aukFdVqiIquI9omu7+XmCznHIVIR+tULlHJSU7IWUUdUKV6DrWs5nkiaIRHSJQoo7pJLQWl0U0g9U0TRNGa0UgjBgb0O/R99ukOoMRibQUfxVYmFgVHIxOOWCVE35ow+EyVooU8H74CP0I0SB+CaXtnEO437kokwNPRnUSsPEhiPQWiMIQoTvCPxgLggb5CY2CcQ1b9MH+rEpWgztBpt+i9o2EJ6CCuM7rHEoswq5sexgQapMHN8pI/wwgkpzJInhaambGm3XQscanu/BD3yG3mMTc7FYIYVCleZi3EgnhaWt0dU9kxkLFcWMDPWM8CWEr7g4s0FbFCishaRGvjGYJzmqqsN6c8B2NdwVQLwnvBaF5No851mkPN6GnWUpz66QkkOjPoyikAmv8J6IuB8vfagUV5fGhzYuV1GAIBSoVyPG/Y6NWmt5GmgtCjtfCtQJIhJfckgqVn3H42aMubsHl54/O5qLdf12+z6dufRhWWM8/ojtds83RtM0vPIstw3qppnV0Dfev67T//RMCnmWtclg6zVy63j0EmN4pil05wq0bcOXRlE4Tg0VUV3T9J7rLCvutTjW3G/yaoy8le0OdT/ypCitL+HOeb5nGtmFFBESQz3lY/nhhy+HfA8fdxushg0rp/xSQej5NqfvWajEIS7WjM7b+YKgFsrTFLZwcK5CmmWwtmCDdJH8F4v2+U/s/vgHu9//xvDbX9BxijzPOA2BTKDcHro8QpcHhCqFdztNX1H4GX4qWGRH8vbgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create Web App\"\n        title=\"\"\n        src=\"/static/2a0c96b51d5e9046dc79f440f3dd3690/f058b/create-web-app.png\"\n        srcset=\"/static/2a0c96b51d5e9046dc79f440f3dd3690/c26ae/create-web-app.png 158w,\n/static/2a0c96b51d5e9046dc79f440f3dd3690/6bdcf/create-web-app.png 315w,\n/static/2a0c96b51d5e9046dc79f440f3dd3690/f058b/create-web-app.png 630w,\n/static/2a0c96b51d5e9046dc79f440f3dd3690/3c051/create-web-app.png 760w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Under the Overview section of the App Service, note the URL listed under Essentials. We will need this when configuring the redirect URIs in the app registration.</p>\n</li>\n</ol>\n<h2>Add a new app registration in Azure AD</h2>\n<ol>\n<li>\n<p>In the Azure Portal, open Azure Active Directory</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 232px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c46b3bbb9d992c3689635a3ba09b4afb/6a451/azure-ad.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42n2Ty27aQBSG8zDdxCQYX8Y2BhNowHZ9A4VrEIRAWqlSIyAoXBRFYlFeo4tuuu+rVOpD9Cn+6hwuRUnbxW/PmTPzzfwzZ05UVYWiKDg7O4MkSUilUkin09wmybLM8enpKTKZDHRdh6Zp/9QJDZ5MJthsNvxfLBYYDAZYrVZYLpd4enrCeDzGer1GHMcM/x/0hD5RFOHm5gbdbhfNZpMn9vt91Ov1g2iRYrHIQFVR2NVLkVsG0iCySiLr6fNzpCSJ23uR9UKhwFBWqbTVLi6VSjBNcwskC0KIrXQNmjAhhHHopzE0qVarIUkSJFGEJIxQjSMkccx91WoVOdveAl9KsmuQjQvoqsIx2cnn8wjDCEEQIvBcNL98R/L5K4JKGUEYcc6yrNdA2XyLN8WPkHL1Q98eGMUxQs9DdTjC7McvXH37iXfNPqLA59xroKpCz6QgaxYfvKZmoGn60Q5DuK4Lz3PhDz7AvR7BrVTgeR7nstljIMEsB8LxIfIV6CTL4RzdHgHpnKgaOp0Ouq0GetdtDIdDrg46R8syj4EKhH0Js9yBFbyH6fUgCsEBaNs2Wq0Wnp+fMZvN8On+HpPpFPP5HI+Pj1xapmnsgTrbo91Z/i2MchtmpQPzsgFNU6GoKhwnz9ba7TYeHh4YMp1OGX5Vr8P3fWSz2b9YLoQQFyGE40HkylugQkAHSRKj0Wig1+thNBphOLzF3d0dWi16DNEL4M62psg7ZXaX8idPNUm1uX//JHrflDMMg+Pf36LMYWWcZfAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Azure AD\"\n        title=\"\"\n        src=\"/static/c46b3bbb9d992c3689635a3ba09b4afb/6a451/azure-ad.png\"\n        srcset=\"/static/c46b3bbb9d992c3689635a3ba09b4afb/c26ae/azure-ad.png 158w,\n/static/c46b3bbb9d992c3689635a3ba09b4afb/6a451/azure-ad.png 232w\"\n        sizes=\"(max-width: 232px) 100vw, 232px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Under the Manage menu, open \"App registrations\" and click \"New registration\"</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa6eef74e4105b0eb1ca2c7473f1e70a/8ce22/new-app-registration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC9klEQVR42nWUe09bRxDFr5RKtQH7Pn3fvr6+D9+3cYgdEwoUCJFSKSRFQk2xDVX4/t/hV+0iVCq1fxzNzu7qzMzZmVXC5WdWZx/59vULV1dXXF9fc3l5ycnJCcvlktVyyXq9ZrVacXx8TNPUWJaFYRjomsZwOERVVTRNk1CsKMOfTMnSlCzLSJIE3/exbVteSLOcummpm4airPCCiCAIsB0X0xzh+wGe7zMa2ZiWhWL7E8IgxLRM9vb2ZMT9/X3G4zHn5+fM8ozz0w9cXZyxfv8OL4ypy5x4MsZxXbmui0z6ruuiWNOU+WJB17ZEUSRLOTg4oK5rnn784M0wZhAsGHo1qt9ghC1q0KIFHcZ4LveGfoMWdpjRIUoeHdLUHfP5HM/zZIa9Xo+yLNlttyijJVr5BWt2gZlfYpfXuPUnrNkVo+Kj9IV9OVMsP6asaqqqJM9zSSR0FBnudlt+GoSowZyBWzJwK4ZeJe2BU76y/6yVaTKVRKPRSMJxHHRdl4QPuw2K+pbJ8V8sLnfkx39Qn24kZiffqU7vn/HLPfXZhuLDd5RJWdN0HYahS/1eNKyqit3ugTc9nb4+Zk+P2DMielpIXw3oCyv2jYi+HkpfnClmXlO1HY5tS/0EoXhlQbjZbHAdm8VhR13O8D2HpmtZHL3l3WpJmiak04h5W9E1FW1dorhRQtu2NKLPigLTfG4fQbjdblFVjWmSEMdToklMnNekZUdSdkzSGXEck6SpvOO5HkqUBdRNLckEqdBOaChfebdjOFQJvDGe62AKSXQV09CfYRpyakQSAqI6xYtzqrqRZIJENLQoWfib+y1h7LC+WJAVHZYTYLkR5sj9l+avobhJQVFVskRRuhi/fr9PURZs/nzATn9m/puB5WY44wwnKhh5Y5ntS2avoVRHJyzfr5nNcsIwlNMi2ufo6IjHx0d6vT66ZqKrQzSJAbqmSln+C8qvn7/y7fdbbm9vubm5kfMrfpW7uzuenp7k1IjIum68gv6/hH8D9sqkTxF4mUcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"New App Registration\"\n        title=\"\"\n        src=\"/static/fa6eef74e4105b0eb1ca2c7473f1e70a/f058b/new-app-registration.png\"\n        srcset=\"/static/fa6eef74e4105b0eb1ca2c7473f1e70a/c26ae/new-app-registration.png 158w,\n/static/fa6eef74e4105b0eb1ca2c7473f1e70a/6bdcf/new-app-registration.png 315w,\n/static/fa6eef74e4105b0eb1ca2c7473f1e70a/f058b/new-app-registration.png 630w,\n/static/fa6eef74e4105b0eb1ca2c7473f1e70a/8ce22/new-app-registration.png 685w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Enter a name and select the supported account types. Also create a Redirect URI for <code class=\"language-text\">https://localhost:5001/</code> and ensure the type is set to \"Single-page application (SPA)\". Click Register.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7acdbc07dc7f312b58418796c3fbc74/f0685/register-an-application.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYElEQVR42q2U2W7bMBBF9diXSCS1U9RKylu8JEptx42BvPUH+gH9nf71LWYaK2raoDHQh4MZUsCQc+eK3v0w4Pn5GdvtFofDAefzGafTCcYYCCEgpbwKL00S5HnOC6UUlFSQQkIEAkEQjJH4UMHeWSyWSxhTwJSGKcsSVV2hqkpe102NoiggpPgnnm0c7jb3+Hy/x8ItoNMCjWmYSlcodYWmbFHmJWKVvEtCMYzh5WkOo0voTDNJlED4EjKQUEJBifAlKkQqQijfR8kQnusdVqslZrMZVqsV2rZFnMRIkoSHMiIFAkE6CkglfyHla/6y9rSp0VkL23Xo+x7OOcznc45N0zBVVfHU6bA0TXHj34yDInzfH4fm6cLgcDxiGAa2y/F4xOPjI7Pf73mPIu1T3nUdH1DXNUcaIOUUySVelmXcKnF7ezu2TVaib9NI0LSnaK359hS5YJiWiPIGYaJZK9qkq1+0Yy9OtJy2evk29akXxQniJGWiMBo1ecvbAmT4qenHgqzdlxMOhz2ezk/ccj/rYZ3l6GYOi+UC1lp0XctDIknarmXtaHi0pv0oiuDN3RwPdw/YrLbYrXfYre84J7PvhwOG3YD1coNSlyiygo1PUJ6nmvUlixGsoc4KuK6HbR1jcoNYxujqjtdN1UIGvwweEmTiS66i3/TllinxA3/kYt7pHpn2vX/3j8eBX5gpUr2+PC9c9Xxd+959oCDdQP2/gkoKKOkjVBJhFP2dMPwwXtZuUCyfkDVrxHmDWHeIC4vEOMTGgv6kq25oz9+x+fYD1e4rgptPkDwEMeG6ln8CKEQYPkbe7h0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Register an application\"\n        title=\"\"\n        src=\"/static/c7acdbc07dc7f312b58418796c3fbc74/f058b/register-an-application.png\"\n        srcset=\"/static/c7acdbc07dc7f312b58418796c3fbc74/c26ae/register-an-application.png 158w,\n/static/c7acdbc07dc7f312b58418796c3fbc74/6bdcf/register-an-application.png 315w,\n/static/c7acdbc07dc7f312b58418796c3fbc74/f058b/register-an-application.png 630w,\n/static/c7acdbc07dc7f312b58418796c3fbc74/f0685/register-an-application.png 835w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>On the Overview screen for the app registration, you should see an Application (client) ID and Directory (tenant) ID. Make note of these as we'll need them later when we configure the web app for authentication.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd65a535b37d48b00e0b2cf820cd6ce1/a242d/app-registration-overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVR42kWRXXOiQBREeTfAMAPDh4iKCLiOgpg1ETVran3Z//+DzhZkzT6c6qnqe7t66lq6e/D6fuHzfud2u3G9Xkd9PB70fU8QaKRUeELgCoHneaM+8QbviSexgjAel4IgQCmF+Lc0qFI+SZwQhpphbhprlK8Jo4gkDokjjXAdhGMjXHt8W83x59jqfD7TdR1N09C0Lc3eIMM5UXUjLU+k9YW6/SBZv5NteurDL1bmQpAZgpnBnxlUusXavd34/XhwOp2oqgpjDMbsMD9qRLTmpfhDWH3iLS+4ix6xOONkb18671HFB/76TlDeEfkVazoNMDtDXddkWTZ+dzKZ8GLbKCmpq5KqqrFtB0coXBkh/BjhJ7iuwHac0Rt9x8VazVPyPCeKItI0xfd9pJRjcBiGlGXFYrkgSWLmy4LSHMk3LXFW4kk5zj4Zdqyi6eiOR7TWOI7zbQ5HGQKHhmW5pihWrIuc02tHs9+y3VT4SiK84Yj/seRsQXM4cGjbseUQ9AzUOiQvSnQ0xfV8ZtmSamNGNts9YTTFkwFS6W/+Amk72FKNJ6VZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"App registration overview\"\n        title=\"\"\n        src=\"/static/bd65a535b37d48b00e0b2cf820cd6ce1/f058b/app-registration-overview.png\"\n        srcset=\"/static/bd65a535b37d48b00e0b2cf820cd6ce1/c26ae/app-registration-overview.png 158w,\n/static/bd65a535b37d48b00e0b2cf820cd6ce1/6bdcf/app-registration-overview.png 315w,\n/static/bd65a535b37d48b00e0b2cf820cd6ce1/f058b/app-registration-overview.png 630w,\n/static/bd65a535b37d48b00e0b2cf820cd6ce1/a242d/app-registration-overview.png 724w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Under the Authentication section, under Single-page application Redirect URIs, add a new URI for the URL of the App Service (i.e. <code class=\"language-text\">https://myauthenticatedapp.azurewebsites.net/</code>)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f66add0357c22233afd7ef0b1e83f4b3/3c492/redirect-uris.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVR42nWS226DMBBE+YFw8Q2MMeCAbWiEIrVp1cf8/09N5U2bKE3ycCQsi9mZWWd6cFiWBfM8I4SAaZqIcXTQWkMpBcbYU6qqeiCzbobWDXa7HfKiIJG2bdG2Blq3JFgUBcqyfPj52ZDM+wnOOXDOkOc5DocDTqcTjscjvPeIMWJdV6Lvexhj0HUdDb1z+Tsw294/sHeXeBdaimxMR2epFKSUBOf8jqtTLsG4ILLP7y+cz2dylHpMDrZtQ4wBXWfIuRQCUoqrcCJVodK3Uqh1B9UYMFEjs+NIsdLE1GPqMy4Lehfg/EoM0wI77NEZc438Rzob6lyTRjaGFcF76iMVL4SE9wExLrD9QNFTlKIs6f4lFQdTbRJc4MaBptV1jbrRmHyEUhKMXTYpBIcQ4ukz+b/1LKxvtE1rLRjjqBuBYbxFsvYWLUV69SYTKfIP3jzn+DwCkFAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Add Redirect URI\"\n        title=\"\"\n        src=\"/static/f66add0357c22233afd7ef0b1e83f4b3/f058b/redirect-uris.png\"\n        srcset=\"/static/f66add0357c22233afd7ef0b1e83f4b3/c26ae/redirect-uris.png 158w,\n/static/f66add0357c22233afd7ef0b1e83f4b3/6bdcf/redirect-uris.png 315w,\n/static/f66add0357c22233afd7ef0b1e83f4b3/f058b/redirect-uris.png 630w,\n/static/f66add0357c22233afd7ef0b1e83f4b3/40601/redirect-uris.png 945w,\n/static/f66add0357c22233afd7ef0b1e83f4b3/78612/redirect-uris.png 1260w,\n/static/f66add0357c22233afd7ef0b1e83f4b3/3c492/redirect-uris.png 1300w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n</ol>\n<h2>Deploy to App Service</h2>\n<ol>\n<li>\n<p>From project root: <code class=\"language-text\">dotnet publish -c Release -o publish</code></p>\n</li>\n<li>\n<p>Using the Azure App Service extension in Visual Studio Code, right-click the publish folder and click \"Deploy to Web App\". Select your newly created App Service and click \"Deploy\"</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 385px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6c4e67a92d3a4cf5bb02c6bcd1a3067/409e6/deploy-to-web-app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAADsElEQVR42o2VyY4jRRRF/QssYIPUVFVmROTkHJx2Ouc5PZTtqgJ1N70A0dBIwI4lJX4KARKiYcWPXfSe20NXlRCLq4iw4t04b7A9UkphGk6RJRmiWYQ0TeE4DoQQUFJCSsn7/6uRdHyESYF2tUWz3KBeXMObJnimm7hQDi7VGLrlQTOfkvtII2V7cCcRwnmGMM7xiW5AUyaSvMI8KxHOE1wKA8IcQ5j2f0o3bIyk5WIa56i6JYpmQFI0MCwHN7d3WK6vsViuEIRTXAkJaZgQhgXBqwmh9tJZBu9HyjARBBMMfY+qrJDGCUzLZrOqbrFaX6Pre7heAGVaEFJBULA0IJUBirdsh2OkVBgp08YknGKz2aIfFijKCs7YZaP19QZN16Hpemy2O3i+z8FHg3eGnh+w2DAIJIoiRt8v0DQt2rZDOJ1hu91huV6jaTvsbm6xu7nBdnfDD213O14Nqh0RvxMber5EmkZsWNc1qqpm4iTNEM3nmEURkjRlAqLZi9JVvCdSysh2xkw88j2JPE+wWCzRNA3ahginGBYLDPRZ2+Lu08+Q5TkHW7YNw7RgmHtz2o9db29IhDNTRxSGSLOc6SjlYBIyFb18IDIti81oPTckKqop3aW0R0YYI05zdG2Hvh+QZTlcz+MmxUnKwUS2NzKPaZOR5G4rNvODyZ7QDGaYzuZsWNcN4jiB6/k8KtT1c5pT/Yz3DMfnhsYkQpIVaJsWZVmxaC6pJiRdyGPxyfxkfCKle1THY8ppXmK323GawzDwa1leIE0zHqWx60LTxdH8XIemUNrcZUGX6BXbYRlMY7E5zeLLl5+jrGpMZzPM44QNzlMmcmricbDJkKTrgldN0/llGpO8KFA3Dbp+YNKu64/zdiCkM2VElEfCc5ExFb6qayabRfNjurSemx1qSLUjUjo/MiRCSpu+u/R1i6I5B3G3z8blYdpESXeeJKRa0KDnRcmvHwivNJ3P+1Gyjl0/pP0kIRkaSqGpCpR5itWiR1uXrM16iTSOILQrKKEfZSoJxzL5L+OxoaaDfnQn+RJu3CHIFvCTDkE6ICxW8JIO0kvek/JTGJMC0vIeGEoD4uJjXFSvMf/5HxT3f2L84x9I7/9C+tNbpPdvcfn9b/jgq1/w0ZvfT/rmV3z43d941v7wkFBB1zRIZ4LVizfYvvoW5eYVutsvsHz+GsPdl1g+/xrJ8gWu/ApaUJ80aSHsyVM1lBC6gDd24Ltjro1tGXy2TROuY8P3xhDa5WPpGv4FGzb2TE3gSz4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Deploy to App Service\"\n        title=\"\"\n        src=\"/static/f6c4e67a92d3a4cf5bb02c6bcd1a3067/409e6/deploy-to-web-app.png\"\n        srcset=\"/static/f6c4e67a92d3a4cf5bb02c6bcd1a3067/c26ae/deploy-to-web-app.png 158w,\n/static/f6c4e67a92d3a4cf5bb02c6bcd1a3067/6bdcf/deploy-to-web-app.png 315w,\n/static/f6c4e67a92d3a4cf5bb02c6bcd1a3067/409e6/deploy-to-web-app.png 385w\"\n        sizes=\"(max-width: 385px) 100vw, 385px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>View the newly deployed web app with the URL provided in the Overview section of the App Service. It should look the same as when you ran the app locally.</p>\n</li>\n</ol>\n<h2>Configure .NET Web API</h2>\n<ol>\n<li>\n<p>Configure <code class=\"language-text\">appsettings.json</code></p>\n<ul>\n<li>\n<p>Add a new section titled \"AzureAd\". Replace <code class=\"language-text\">ENTER_CLIENT_ID_GUID_HERE</code> with your Application (client) ID listed in the app registration in Azure AD, and replace <code class=\"language-text\">ENTER_TENANT_ID_GUID_HERE</code> with the Directory (tenant) ID.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"AzureAd\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Instance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://login.microsoftonline.com/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ClientId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ENTER_CLIENT_ID_GUID_HERE\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"TenantId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ENTER_TENANT_ID_GUID_HERE\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Audience\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ENTER_CLIENT_ID_GUID_HERE\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Install NuGet packages</p>\n<ul>\n<li><code class=\"language-text\">dotnet add my-authenticated-app.csproj package Microsoft.AspNetCore.Authentication.JwtBearer</code></li>\n<li><code class=\"language-text\">dotnet add my-authenticated-app.csproj package Microsoft.Identity.Web</code></li>\n</ul>\n</li>\n<li>\n<p>Setup <code class=\"language-text\">Startup.cs</code></p>\n<ul>\n<li>\n<p>Add the following uncommented code blocks:</p>\n</li>\n<li>\n<p><code class=\"language-text\">ConfigureServices()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ConfigureServices</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IServiceCollection</span> services<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//services.AddControllersWithViews();</span>\n    <span class=\"token comment\">//services.AddSpaStaticFiles(configuration =></span>\n    <span class=\"token comment\">//{</span>\n    <span class=\"token comment\">//    configuration.RootPath = \"ClientApp/dist\";</span>\n    <span class=\"token comment\">//});</span>\n\n    services<span class=\"token punctuation\">.</span><span class=\"token function\">AddAuthentication</span><span class=\"token punctuation\">(</span>JwtBearerDefaults<span class=\"token punctuation\">.</span>AuthenticationScheme<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">AddMicrosoftIdentityWebApi</span><span class=\"token punctuation\">(</span>Configuration<span class=\"token punctuation\">,</span> <span class=\"token string\">\"AzureAd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    services<span class=\"token punctuation\">.</span><span class=\"token function\">AddAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">Configure()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IApplicationBuilder</span> app<span class=\"token punctuation\">,</span> <span class=\"token class-name\">IWebHostEnvironment</span> env<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//if (env.IsDevelopment())</span>\n    <span class=\"token comment\">//{</span>\n    <span class=\"token comment\">//    app.UseDeveloperExceptionPage();</span>\n    <span class=\"token comment\">//}</span>\n    <span class=\"token comment\">//else</span>\n    <span class=\"token comment\">//{</span>\n    <span class=\"token comment\">//    app.UseExceptionHandler(\"/Error\");</span>\n    <span class=\"token comment\">//    // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.</span>\n    <span class=\"token comment\">//    app.UseHsts();</span>\n    <span class=\"token comment\">//}</span>\n\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">UseCors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//app.UseHttpsRedirection();</span>\n    <span class=\"token comment\">//app.UseStaticFiles();</span>\n    <span class=\"token comment\">//if (!env.IsDevelopment())</span>\n    <span class=\"token comment\">//{</span>\n    <span class=\"token comment\">//    app.UseSpaStaticFiles();</span>\n    <span class=\"token comment\">//}</span>\n\n    <span class=\"token comment\">//app.UseRouting();</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">UseAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">UseAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   \n    <span class=\"token range operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Add the <code class=\"language-text\">Authorize</code> attribute to <code class=\"language-text\">WeatherController</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Authorize</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\">//[ApiController]</span>\n<span class=\"token comment\">//[Route(\"[controller]\")]</span>\n<span class=\"token comment\">//public class MyController : ControllerBase</span>\n<span class=\"token comment\">//{</span>\n<span class=\"token comment\">//}</span></code></pre></div>\n</li>\n</ol>\n<h2>Configure Angular app with MSAL</h2>\n<ol>\n<li>\n<p>Install packages</p>\n<ul>\n<li>From the <code class=\"language-text\">ClientApp</code> folder, run <code class=\"language-text\">npm i msal @azure/msal-browser @azure/msal-angular</code></li>\n</ul>\n</li>\n<li>\n<p>Configure environment settings</p>\n<ul>\n<li>\n<p>Replace <code class=\"language-text\">ENTER_DEV_URL_HERE</code> with your development URL (i.e. \"<a href=\"https://localhost:5001/\">https://localhost:5001/</a>\")</p>\n</li>\n<li>\n<p>Replace <code class=\"language-text\">ENTER_PUBLIC_URL_HERE</code> with the App Service's URL (i.e. \"<a href=\"https://myauthenticatedapp.azurewebsites.net/\">https://myauthenticatedapp.azurewebsites.net/</a>\")</p>\n</li>\n<li>\n<p>Replace <code class=\"language-text\">ENTER_CLIENT_ID_GUID_HERE</code> with the client ID from the app registration</p>\n</li>\n<li>\n<p>Replace <code class=\"language-text\">ENTER_TENANT_NAME_HERE</code> with the tenant name. This can be found in the Azure portal URL when viewing the App Service page (\"<a href=\"https://portal.azure.com/#@YOUR_TENANT_NAME.onmicrosoft.com/resource/subscriptions/and-so-on\">https://portal.azure.com/#@YOUR_TENANT_NAME.onmicrosoft.com/resource/subscriptions/and-so-on</a>\")</p>\n</li>\n<li>\n<p><code class=\"language-text\">environment.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> environment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  production<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  redirectUrl<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_DEV_URL_HERE'</span><span class=\"token punctuation\">,</span>\n  clientId<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_CLIENT_ID_GUID_HERE'</span><span class=\"token punctuation\">,</span>\n  tenantName<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_TENANT_NAME_HERE'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">environment.prod.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> environment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  production<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  redirectUrl<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_PUBLIC_URL_HERE'</span><span class=\"token punctuation\">,</span>\n  clientId<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_CLIENT_ID_GUID_HERE'</span><span class=\"token punctuation\">,</span>\n  tenantName<span class=\"token operator\">:</span> <span class=\"token string\">'ENTER_TENANT_NAME_HERE'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Configure MSAL in <code class=\"language-text\">app.module.ts</code></p>\n<ul>\n<li>\n<p>Add the following imports, functions, and module imports, providers, and bootstraps</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">HTTP_INTERCEPTORS</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/common/http'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> IPublicClientApplication<span class=\"token punctuation\">,</span> PublicClientApplication<span class=\"token punctuation\">,</span> InteractionType<span class=\"token punctuation\">,</span> BrowserCacheLocation<span class=\"token punctuation\">,</span> LogLevel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@azure/msal-browser'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MsalGuard<span class=\"token punctuation\">,</span> MsalInterceptor<span class=\"token punctuation\">,</span> MsalBroadcastService<span class=\"token punctuation\">,</span> MsalInterceptorConfiguration<span class=\"token punctuation\">,</span> MsalModule<span class=\"token punctuation\">,</span> MsalService<span class=\"token punctuation\">,</span> <span class=\"token constant\">MSAL_GUARD_CONFIG</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MSAL_INSTANCE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MSAL_INTERCEPTOR_CONFIG</span><span class=\"token punctuation\">,</span> MsalGuardConfiguration<span class=\"token punctuation\">,</span> MsalRedirectComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@azure/msal-angular'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> environment <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../environments/environment'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> isIE <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MSIE \"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span> window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Trident/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Remove this line to use Angular Universal</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loggerCallback</span><span class=\"token punctuation\">(</span>logLevel<span class=\"token operator\">:</span> LogLevel<span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MSALInstanceFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IPublicClientApplication <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PublicClientApplication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    auth<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      clientId<span class=\"token operator\">:</span> environment<span class=\"token punctuation\">.</span>clientId<span class=\"token punctuation\">,</span>\n      authority<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://login.microsoftonline.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>environment<span class=\"token punctuation\">.</span>tenantName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.onmicrosoft.com/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      redirectUri<span class=\"token operator\">:</span> environment<span class=\"token punctuation\">.</span>redirectUrl\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    cache<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      cacheLocation<span class=\"token operator\">:</span> BrowserCacheLocation<span class=\"token punctuation\">.</span>LocalStorage<span class=\"token punctuation\">,</span>\n      storeAuthStateInCookie<span class=\"token operator\">:</span> isIE<span class=\"token punctuation\">,</span> <span class=\"token comment\">// set to true for IE 11</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    system<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      loggerOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        loggerCallback<span class=\"token punctuation\">,</span>\n        logLevel<span class=\"token operator\">:</span> LogLevel<span class=\"token punctuation\">.</span>Info<span class=\"token punctuation\">,</span>\n        piiLoggingEnabled<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MSALInterceptorConfigFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MsalInterceptorConfiguration <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> protectedResourceMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">>></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  protectedResourceMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>environment<span class=\"token punctuation\">.</span>redirectUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">weatherforecast</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>environment<span class=\"token punctuation\">.</span>clientId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/.default</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    interactionType<span class=\"token operator\">:</span> InteractionType<span class=\"token punctuation\">.</span>Redirect<span class=\"token punctuation\">,</span>\n    protectedResourceMap\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MSALGuardConfigFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MsalGuardConfiguration <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    interactionType<span class=\"token operator\">:</span> InteractionType<span class=\"token punctuation\">.</span>Redirect<span class=\"token punctuation\">,</span>\n    authRequest<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      scopes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>environment<span class=\"token punctuation\">.</span>clientId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/.default</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">NgModule</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n    MsalModule\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      provide<span class=\"token operator\">:</span> <span class=\"token constant\">HTTP_INTERCEPTORS</span><span class=\"token punctuation\">,</span>\n      useClass<span class=\"token operator\">:</span> MsalInterceptor<span class=\"token punctuation\">,</span>\n      multi<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      provide<span class=\"token operator\">:</span> <span class=\"token constant\">MSAL_INSTANCE</span><span class=\"token punctuation\">,</span>\n      useFactory<span class=\"token operator\">:</span> MSALInstanceFactory\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      provide<span class=\"token operator\">:</span> <span class=\"token constant\">MSAL_GUARD_CONFIG</span><span class=\"token punctuation\">,</span>\n      useFactory<span class=\"token operator\">:</span> MSALGuardConfigFactory\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      provide<span class=\"token operator\">:</span> <span class=\"token constant\">MSAL_INTERCEPTOR_CONFIG</span><span class=\"token punctuation\">,</span>\n      useFactory<span class=\"token operator\">:</span> MSALInterceptorConfigFactory\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    MsalService<span class=\"token punctuation\">,</span>\n    MsalGuard<span class=\"token punctuation\">,</span>\n    MsalBroadcastService\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  bootstrap<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n    MsalRedirectComponent\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Create an auth service</p>\n<ul>\n<li>\n<p>From the <code class=\"language-text\">ClientApp</code> folder, run <code class=\"language-text\">ng g s auth</code></p>\n</li>\n<li>\n<p><code class=\"language-text\">auth.service.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MsalService<span class=\"token punctuation\">,</span> MsalBroadcastService<span class=\"token punctuation\">,</span> <span class=\"token constant\">MSAL_GUARD_CONFIG</span><span class=\"token punctuation\">,</span> MsalGuardConfiguration <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@azure/msal-angular'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountInfo<span class=\"token punctuation\">,</span> AuthenticationResult<span class=\"token punctuation\">,</span> InteractionStatus<span class=\"token punctuation\">,</span> InteractionType<span class=\"token punctuation\">,</span> PopupRequest<span class=\"token punctuation\">,</span> RedirectRequest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@azure/msal-browser'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Subject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filter<span class=\"token punctuation\">,</span> takeUntil <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs/operators'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  providedIn<span class=\"token operator\">:</span> <span class=\"token string\">'root'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthService</span> <span class=\"token punctuation\">{</span>\n  loggedIn <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _destroying$ <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subject<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MSAL_GUARD_CONFIG</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> msalGuardConfig<span class=\"token operator\">:</span> MsalGuardConfiguration<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">private</span> authService<span class=\"token operator\">:</span> MsalService<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">private</span> msalBroadcastService<span class=\"token operator\">:</span> MsalBroadcastService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">updateLoggedInStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalBroadcastService<span class=\"token punctuation\">.</span>inProgress$\n      <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>status<span class=\"token operator\">:</span> InteractionStatus<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> status <span class=\"token operator\">===</span> InteractionStatus<span class=\"token punctuation\">.</span>None<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">takeUntil</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_destroying$<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setLoggedIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkAndSetActiveAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalGuardConfig<span class=\"token punctuation\">.</span>interactionType <span class=\"token operator\">===</span> InteractionType<span class=\"token punctuation\">.</span>Popup<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginWithPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginWithRedirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getActiveAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> AccountInfo <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">getActiveAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">checkAndSetActiveAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n    * If no active account set but there are accounts signed in, sets first account to active account\n    * To use active account set here, subscribe to inProgress$ first in your component\n    * Note: Basic usage demonstrated. Your app may require more complicated account selection logic\n    */</span>\n    <span class=\"token keyword\">let</span> activeAccount <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">getActiveAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>activeAccount <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">getAllAccounts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> accounts <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">getAllAccounts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">setActiveAccount</span><span class=\"token punctuation\">(</span>accounts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">setLoggedIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggedIn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">getAllAccounts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">loginWithPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalGuardConfig<span class=\"token punctuation\">.</span>authRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">loginPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalGuardConfig<span class=\"token punctuation\">.</span>authRequest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> PopupRequest<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token operator\">:</span> AuthenticationResult<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">setActiveAccount</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>account<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">loginPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token operator\">:</span> AuthenticationResult<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span><span class=\"token function\">setActiveAccount</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>account<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">loginWithRedirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalGuardConfig<span class=\"token punctuation\">.</span>authRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">loginRedirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msalGuardConfig<span class=\"token punctuation\">.</span>authRequest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> RedirectRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">loginRedirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_destroying$<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_destroying$<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Add the <code class=\"language-text\">app-redirect</code> component to <code class=\"language-text\">index.html</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>app-root</span><span class=\"token punctuation\">></span></span>Loading...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>app-root</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>app-redirect</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>app-redirect</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n<li>\n<p>Implement <code class=\"language-text\">AuthService</code> in the <code class=\"language-text\">AppComponent</code></p>\n<ul>\n<li>\n<p><code class=\"language-text\">app.component.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> OnInit <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./auth.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Component</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'app-root'</span><span class=\"token punctuation\">,</span>\n  templateUrl<span class=\"token operator\">:</span> <span class=\"token string\">'./app.component.html'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppComponent</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnInit</span> <span class=\"token punctuation\">{</span>\n  title <span class=\"token operator\">=</span> <span class=\"token string\">'app'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> authService<span class=\"token operator\">:</span> AuthService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">updateLoggedInStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authService<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">app.component.html</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>app-nav-menu</span> <span class=\"token attr-name\">[loggedIn]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>authService.loggedIn<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(loginClicked)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>login()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(logoutClicked)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>logout()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>app-nav-menu</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>router-outlet</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>router-outlet</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Update the <code class=\"language-text\">NavMenuComponent</code> with login/logout buttons</p>\n<ul>\n<li>\n<p><code class=\"language-text\">nav-menu.component.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> EventEmitter<span class=\"token punctuation\">,</span> Input<span class=\"token punctuation\">,</span> Output <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Component</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'app-nav-menu'</span><span class=\"token punctuation\">,</span>\n  templateUrl<span class=\"token operator\">:</span> <span class=\"token string\">'./nav-menu.component.html'</span><span class=\"token punctuation\">,</span>\n  styleUrls<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./nav-menu.component.css'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NavMenuComponent</span> <span class=\"token punctuation\">{</span>\n  isExpanded <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Input</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> loggedIn<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Output</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> loginClicked <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventEmitter<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Output</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> logoutClicked <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventEmitter<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">collapse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isExpanded <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isExpanded <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isExpanded<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loginClicked<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logoutClicked<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p><code class=\"language-text\">nav-menu.component.html</code></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>header</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nav</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-brand<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLink]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['/']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>my_authenticated_app<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-toggler<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-toggle</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>collapse<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.navbar-collapse<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">aria-label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Toggle navigation<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[attr.aria-expanded]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>isExpanded<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(click)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>toggle()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-toggler-icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-collapse collapse d-sm-inline-flex justify-content-end<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[ngClass]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{ show: isExpanded }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-nav flex-grow<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLinkActive]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['link-active']<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLinkActiveOptions]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{ exact: true }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-link text-dark<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLink]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['/']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLinkActive]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['link-active']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-link text-dark<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLink]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['/counter']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Counter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLinkActive]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['link-active']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-link text-dark<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[routerLink]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>['/fetch-data']<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Fetch data<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(click)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>login()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">*ngIf</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!loggedIn<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Login<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(click)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>logout()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">*ngIf</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>loggedIn<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Logout<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nav</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>header</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>Run the app and test authentication</p>\n<ul>\n<li>\n<p>When viewing the Fetch Data page, if you are not logged in, you will be redirected to the Microsoft login screen. If you are not redirected, click the Login button.</p>\n</li>\n<li>\n<p>When logging in for the first time, you will need to approve the app's permissions</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 476px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf21b18c342b9dd04d9add3d0863ea75/f2205/permissions-requested.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 129.1139240506329%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADW0lEQVR42q1VyW4qVxT0B2SXT8kmX5VVviFSVpHyA5EiRdl6kbyFn2WwbJ6fk24IGAwGAz3Rt29PmKmZqagOw8OJrQxyS6XTfZtbt06dc+gT5ViIdYAo8BFpH6FWnxAGCKPn0EQcIDhACVSs0PHaOCHZW1ybzQa2b5FQyULQ/ADHzSNJBnh6ekIcx1iv1/+dMNoR1uwmlHeNMEwRhhpa6/9B2H3rlLtUuCUcDAYYDgfIsgyTyUQwnU4xn88xm80k8pnrvP9Hwnq9jsvLS1xfX+Pi4gK5XA5XV1e4u7vD2dmZgOunp6fy2z3J3whDrWVB6wCd9iNs20K32xU0Gg34vi/vl8ulbNrjmOhFwoajUag8otxyEYahoNfrSfyrmtc8dLaE2w3DcYZkMMEom2GSZeLTYrGQSN+GwyHG47GAftNr3lP5M0K9U8hWeWy10GjUUavV0Gw2Ydu2oFqtolwui3e04f7+Hg8PD/LMw3itDwp3KfFU+sXnKIoQBIGkTBX/tm22CneEq8UMWitYliVEjuMISMwDRqPRYeNxYY6jq7o4CcJIFvzBBkE6QRKHojZJEhk/goQcR/Yje5ET9BKxR0Klt4Q/l4Gr1hSjNEQcJ0LI9EnIA/ZVp+er1erFlL1jhdNsgtFwIJsJKtorTdNUwDXG/UFEv98/KO0dE3Y6HRQKBZmOYrGIm5sb5PN5mKYp1WRlWX1Wm9PDyvMd19hevHaE8bYPh0NJh2AhGJVS4hlT5KbFcin+7fuTcZ8+FfrBkULbcWAYhigolUoSb29vJZqGAdP4DeWiiaJpwjBNUUmFPFT6cL3eEqqdwna7LQRMoVKpyIbfDQN/lEooVeso1pr4WG6g2mghTRLMZgtk8m+0eK5QRYks0Hz2neu6Mh1sct57rgMvHqCTLmH1F4gmq1cbW2mmvCOkV2xeesnIkWKV+/1U5jwdz2XOk9EM0WgOPdyC9/MVe3GDQHc+Eb500XRacH7+Hr++e4eycYOf8lV8/nUOX3xTwJfffsRnX73HL5VwV2USxq8T0mj2HC3odLsIAx81O8L3OQc/fPDw400P351baEfZ9kMXCGH6Zt8UzZTbrg/bD+D4Co5ScA/w4Ql68HxX0FMuPOXC9W14Aguub0EpC0HQhfIf8CdVIavgbs2XrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Permissions requested\"\n        title=\"\"\n        src=\"/static/cf21b18c342b9dd04d9add3d0863ea75/f2205/permissions-requested.png\"\n        srcset=\"/static/cf21b18c342b9dd04d9add3d0863ea75/c26ae/permissions-requested.png 158w,\n/static/cf21b18c342b9dd04d9add3d0863ea75/6bdcf/permissions-requested.png 315w,\n/static/cf21b18c342b9dd04d9add3d0863ea75/f2205/permissions-requested.png 476w\"\n        sizes=\"(max-width: 476px) 100vw, 476px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>After successfully logging in, refresh the Fetch Data page. The weather data should load.</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>Redeploy to App Service</h2>\n<ol>\n<li>Following the same steps as before, publish the web app and deploy it to the App Service.</li>\n<li>Load the webpage and verify the authentication works.</li>\n</ol>\n<h2>Things to Consider</h2>\n<ol>\n<li>For security purposes, you can configure the <code class=\"language-text\">appsettings.json</code> settings in the Configuration section in the App Service instead. This way, you aren't committing the client and tenant IDs in source control.</li>\n<li>For each API endpoint you want to secure, add the <code class=\"language-text\">Authorize</code> attribute to the controller and add a new entry to the <code class=\"language-text\">protectedResourceMap</code> in <code class=\"language-text\">app.module.ts</code> with the given endpoint.</li>\n</ol>\n<h2>Conclusion</h2>\n<p>Authentication can be tricky, but with the <code class=\"language-text\">msal-angular</code> package and the Microsoft Identity platform it's rather easy. With these libraries handling the technical details, we just have to handle the configuration.</p>","frontmatter":{"title":"Adding Authentication with Azure AD to a .NET Angular Web App with MSAL","date":"March 11, 2021","description":"Adding authentication to any app should be straightforward. Here's how to do it with Azure AD in a .NET Angular app using MSAL."}},"previous":{"fields":{"slug":"/event-driven-systems/"},"frontmatter":{"title":"Differences between Traditional and Event-Driven Systems"}},"next":null},"pageContext":{"id":"5d37dc7f-d842-55d5-a494-2e67a5cc9242","previousPostId":"446c6bc5-ff77-5df8-8250-5b39cd057db6","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}